<!DOCTYPE html>
<meta charset="utf-8">
<meta name = "viewport"
      content = "width = device-width,
                 initial-scale = 1.0,
                 maximum-scale = 1.0,
                 user-scalable = no">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-material-design/4.0.2/bootstrap-material-design.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.1/react.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.1/react-dom.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.15.3/axios.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>
<script src="https://unpkg.com/mobx@3.0.1/lib/mobx.umd.min.js"></script>
<script src="https://unpkg.com/mobx-react@4.1.0/index.min.js"></script>

<body><script>
function App(state) {
    for(var k in state)
        if('function' === typeof(state[k]))
            state[k] = mobx.action(state[k])

    state = mobx.observable(state)

    function decorator(component) {
        return React.createElement(
            mobxReact.observer(component),
            {state})
    }

    const routes = {}

    function addRoute(route, component) {
        routes[route] = decorator(component)
    }

    function render() {
        return React.createElement(
            class extends React.Component {
                componentDidMount() {
                    window.onhashchange = () => this.setState({})
                }

                render() {
                    const a = document.createElement('a')
                    a.href = window.location

                    return routes[a.hash? a.hash.slice(2): '']
                }
            })
    }

    function mount(divId) {
        let div = document.getElementById(divId)
        if(undefined == divId) {
            div = document.createElement('div')
            document.body.appendChild(div)
        }

        ReactDOM.render(render(), div)
    }

    return {render, decorator, addRoute, mount}
}
</script></body>

<script>
const app = App({
    timestamp: null,
    nClicks: 0,
    nMouseOver: 0,
    nMouseOut: 0,
                              
    get total() {
      return JSON.stringify({
              Clicks: this.nClicks,
              MouseOver: this.nMouseOver,
              MouseOut: this.nMouseOut,
              timestamp: this.timestamp,
              Total: this.nClicks + this.nMouseOver + this.nMouseOut
          }, null, 4)
      
    },
  
    incrClick() {
        this.nClicks++
    },

    incrMouseOver() {
        this.nMouseOver++
    },

    incrMouseOut() {
        this.nMouseOut++
    },

    reset() {
      this.nClicks = 0
      this.nMouseOver = 0
      this.nMouseOut = 0
    },

    timer() {
        if(null === this.timestamp) {
            this.timestamp = 'timer started'
            setInterval(() => this.timestamp = new Date(), 1000)
        }
    }
})

function Counters(props) {
    const {div, pre, button, a} = React.DOM

    return div({className: 'container'},
        pre({
            onClick: () => props.state.incrClick(),
            onMouseOver: () => props.state.incrMouseOver(),
            onMouseOut: () => props.state.incrMouseOut()},
            props.state.total),
        button({
            onClick: () => props.state.reset()},
            'RESET'),
        button({
            onClick: () => props.state.timer()},
            'TIMER'),
        a({
            href: '#/props'},
            'PROPS'))
}

function Props(props) {
    return React.DOM.div({className: 'container'},
        React.DOM.pre(null, JSON.stringify(mobx.toJS(props.state), null, 4)))
}

app.addRoute('', Counters)
app.addRoute('props', Props)
app.mount()
</script>
