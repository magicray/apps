<!DOCTYPE html>
<meta charset="utf-8">
<meta name = "viewport"
      content = "width = device-width,
                 initial-scale = 1.0,
                 maximum-scale = 1.0,
                 user-scalable = no">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-material-design/4.0.2/bootstrap-material-design.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.1/react.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.1/react-dom.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.15.3/axios.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>
<script src="https://unpkg.com/mobx@3.0.1/lib/mobx.umd.min.js"></script>
<script src="https://unpkg.com/mobx-react@4.1.0/index.min.js"></script>

<body><script>
function App(store) {
    mobx.useStrict(true)

    for(var k in store)
        if('function' === typeof(store[k]))
            store[k] = mobx.action(store[k])

    store = mobx.observable(store)

    function wrap(component, params) {
        return React.createElement(
            mobxReact.observer(component),
            {store, params})
    }

    const routes = {}

    function route(hash, component) {
        routes[hash? hash: ''] = wrap(component)
    }

    function render(div) {
        const elem = React.createElement(
            class extends React.Component {
                componentDidMount() {
                    window.onhashchange = () => this.setState({})
                }

                render() {
                    const a = document.createElement('a')
                    a.href = window.location

                    return routes[a.hash? a.hash.slice(1): '']
                }
            })

        return div? ReactDOM.render(elem, div): elem
    }

    return {store, wrap, route, render}
}
</script></body>

<script>
const {store, wrap, route, render} = App({
    timestamp: 'not fetched yet',

    counters: [
        {clicks: 0, mouseOver: 0, mouseOut: 0},
        {clicks: 0, mouseOver: 0, mouseOut: 0}
    ],
                              
    incrClick(i) {
        this.counters[i].clicks++
    },

    incrMouseOver(i) {
        this.counters[i].mouseOver++
    },

    incrMouseOut(i) {
        this.counters[i].mouseOut++
    },

    reset(i) {
      this.counters[i] = {clicks: 0, mouseOver: 0, mouseOut: 0}
    },

    setTimestamp(timestamp) {
        this.timestamp = timestamp
    }
})

function Props({params: {index}, store}) {
    const js = mobx.toJS(store.counters[index])
    js.timestamp = store.timestamp

    return React.DOM.div({className: 'container'},
        React.DOM.pre(null, JSON.stringify(js, null, 4)))
}

function Counters({params: {index}, store}) {
    const text = JSON.stringify({
        Clicks: store.counters[index].clicks,
        MouseOver: store.counters[index].mouseOver,
        MouseOut: store.counters[index].mouseOut,
        timestamp: store.timestamp}, null, 4)
      
    const {div, pre, button, a} = React.DOM

    return div({className: 'container'},
        pre({
            onClick: () => store.incrClick(index),
            onMouseOver: () => store.incrMouseOver(index),
            onMouseOut: () => store.incrMouseOut(index)},
            text),
        button({
            onClick: () => store.reset(index)},
            'RESET'),
        a({
            href: '#props'},
            'PROPS'))
}

route('props', function(props) {
    return React.DOM.div({className: 'container'},
        wrap(Props, {index: 0}),
        wrap(Props, {index: 1}))
})

route(null, function(props) {
    return React.DOM.div({className: 'container'},
        wrap(Counters, {index: 0}),
        wrap(Counters, {index: 1}))
})

render(document.body)

setInterval(() => store.setTimestamp(new Date()), 1000)
</script>
