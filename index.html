<!DOCTYPE html>
<html>
<link rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

<link rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css">

<script src="https://cdn.jsdelivr.net/lodash/4.17.2/lodash.min.js"></script>
<script src="https://cdn.jsdelivr.net/immutable.js/3.8.1/immutable.min.js"</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/react-bootstrap/0.30.7/react-bootstrap.min.js"></script>

<script src="https://cdn.jsdelivr.net/react/15.4.1/react.min.js"></script>
<script src="https://cdn.jsdelivr.net/react/15.4.1/react-dom.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-router/4.0.0-0/react-router.min.js"></script>

<script src="https://cdn.jsdelivr.net/redux/3.6.0/redux.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-redux/4.4.6/react-redux.min.js"></script>

<head>
  <meta charset="utf-8">
  <meta name = "viewport"
        content = "width = device-width,
                   initial-scale = 1.0,
                   maximum-scale = 1.0,
                   user-scalable = no">
</head>

<script>
function Page1View(props) {
        const onClick = e => props.onClick()
        const onChange = e => props.onChange(e.target.value)

        const {div, pre, input, button} = React.DOM

        return div({className: 'container'},
                    div({className: 'row'},
                        input({className: 'col-sm-12',
                               style: {width: "100%"},
                               onChange: onChange})),
                    div({className: 'row'},
                        pre({className: 'col-sm-12'}, props.text)),
                    div({className: 'row'},
                        button({className: 'col-sm-12',
                                onClick: onClick}, 'Toggle')))
}

class Page1Container extends React.Component {
    render() {
        let {text, flag} = this.props.state
        text = flag? text.split('').reverse().join(''): text

        return Page1View({
            text: text,
            onChange: this.props.updateText,
            onClick: this.props.toggleText
        })
    }
}

function Page2View(props) {
    const {pre} = React.DOM

    return pre(null, 'Page2')
}
</script>

<script>
function reducer(state, action) {
    switch(action.type) {
        case 'UPDATE_TEXT':
            return {text: action.text, flag: state.flag}

        case 'TOGGLE_TEXT':
            return {text: state.text, flag: state.flag? false: true}
    }
    return state
}

const Actions = {
    updateText(text) { return {
        type: 'UPDATE_TEXT',
        text
    }},

    toggleText() { return {
        type: 'TOGGLE_TEXT'
    }}
}
</script>

<script>
function connect(component) {
    return React.createFactory(
        ReactRedux.connect((state) => {return {state: state}}, Actions)             (component))
}
</script>

<body>
    <div id="app"></div>

    <script>
        const store = Redux.createStore(reducer, {
            text: 'initial text',
            flag: false
        })

        const PAGE1 = connect(Page1Container)
        const PAGE2 = React.createFactory(Page2View)

        const {div, ul, li} = React.DOM
        const Provider = React.createFactory(ReactRedux.Provider)

        const Link = React.createFactory(ReactRouter.Link)
        const Match = React.createFactory(ReactRouter.Match)
        const BrowserRouter = React.createFactory(ReactRouter.BrowserRouter)

        ReactDOM.render(
            Provider({store:store},
                BrowserRouter(null,
                    ul({className: 'nav navbar-nav navbar-inverse'},
                        li(null, Link({to: '/1'}, 'Page1')),
                        li(null, Link({to: '/2'}, 'Page2'))),
                    Match({pattern: '/1', component: PAGE1}),
                    Match({pattern: '/2', component: PAGE2}))),
            document.getElementById('app'))
    </script>
</body>
</html>
