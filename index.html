<!DOCTYPE html>
<html>
<link rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

<link rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.2/lodash.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-bootstrap/0.30.7/react-bootstrap.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.1/react.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.1/react-dom.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/redux/3.6.0/redux.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-redux/4.4.6/react-redux.min.js"></script>

<head>
  <meta charset="utf-8">
  <meta name = "viewport"
        content = "width = device-width,
                   initial-scale = 1.0,
                   maximum-scale = 1.0,
                   user-scalable = no">
</head>

<script>
function InputBox(props) {
    return React.DOM.input({
        style: {width: "100%"},
        onChange: e => props.onChange(e.target.value)})
}

function TextDisplay(props) {
    return React.DOM.pre(null, props.text)
}

function ToggleButton(props) {
    return React.DOM.button({
        style: {width: "100%"},
        onClick: props.onClick}, 'Toggle')
}

class HelloWorld extends React.Component {
    constructor(props) {
        super(props)
    }

    render() {
        const {div, pre} = React.DOM
        const input = React.createFactory(InputBox)
        const display = React.createFactory(TextDisplay)

        return div({className: 'container'},
                    div({className: 'row'},
                        div({className: 'col-sm-12'},
                            input({onChange: this.props.updateText}))),
                    div({className: 'row'},
                        div({className: 'col-sm-12'},
                            display({text: this.props.text}))),
                    div({className: 'row'},
                        div({className: 'col-sm-12'},
                        ToggleButton({onClick: this.props.toggleText}))))
    }

    static propsMap(state) { return {
        text: state.flag? state.text.split('').reverse().join(''): state.text
    }}
}
</script>

<script>
function reducer(state, action) {
    switch(action.type) {
        case 'UPDATE_TEXT':
            return {text: action.text, flag: state.flag}

        case 'TOGGLE_TEXT':
            return {text: state.text, flag: state.flag? false: true}
    }
    return state
}

class Actions {
    static updateText(text) {
        return {
            type: 'UPDATE_TEXT',
            text
        }
    }

    static toggleText() {
        return {
            type: 'TOGGLE_TEXT'
        }
    }
}
</script>

<script>
function makeContainer(component) {
    const actions = {}
    Object.getOwnPropertyNames(Actions).map((f) => {
        if('function' == typeof(Actions[f])) {
            actions[f] = Actions[f]
        }
    })

    return React.createFactory(
        ReactRedux.connect(component.propsMap, actions)(component))
}

function renderApp(initStore, reducer, rootContainer) {
    const store = Redux.createStore(reducer, initStore)

    ReactDOM.render(React.createElement(
            ReactRedux.Provider,
            {store: store},
            rootContainer),
        document.body)
}
</script>

<body>
    <script>
        const store = {
            text: 'initial text',
            flag: false
        }

        const APP = makeContainer(HelloWorld)
        const div = React.DOM.div

        renderApp(store, reducer,
            div({},
                APP()))
    </script>
</body>
</html>
