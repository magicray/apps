<!DOCTYPE html>
<html>
<link rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

<link rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css">

<script src="https://cdn.jsdelivr.net/react/15.4.1/react.min.js"></script>
<script src="https://cdn.jsdelivr.net/react/15.4.1/react-dom.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-bootstrap/0.30.7/react-bootstrap.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/react-router/4.0.0-0/react-router.min.js"></script>

<script src="https://cdn.jsdelivr.net/redux/3.6.0/redux.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-redux/4.4.6/react-redux.min.js"></script>

<head>
  <meta charset="utf-8">
  <meta name = "viewport"
        content = "width = device-width,
                   initial-scale = 1.0,
                   maximum-scale = 1.0,
                   user-scalable = no">
</head>

<script>
function TextReverseView(props) {
    const onClick = e => props.onClick()
    const onChange = e => props.onChange(e.target.value)

    const r = ReactBootstrap
    const e = React.createElement

    return e(r.Form, null,
        e(r.FormGroup, null,
            e(r.FormControl, {
                type: 'text',
                value: props.text,
                onChange}),
            e(r.ControlLabel, null, props.processed),
            e(r.ButtonToolbar, null,
                e(r.Button, {bsStyle: 'primary', onClick}, 'Toggle'))))
}

class TextReverse extends React.Component {
    render() {
        let {text, flag} = this.props.state

        return TextReverseView({
            text,
            processed: flag? text.split('').reverse().join(''): text,
            onChange: this.props.updateText,
            onClick: this.props.toggleText
        })
    }
}

function Props(props) {
    return React.DOM.pre(null, JSON.stringify(props, null, 4))
}

function HomePage(props) {
    return React.createElement(
        ReactBootstrap.Jumbotron, null,
            React.DOM.h1(null, 'React Examples'))
}
</script>

<script>
function reducer(state, action) {
    switch(action.type) {
        case 'UPDATE_TEXT':
            return {text: action.text, flag: state.flag}

        case 'TOGGLE_TEXT':
            return {text: state.text, flag: state.flag? false: true}
    }
    return state
}

const Actions = {
    updateText(text) { return {
        type: 'UPDATE_TEXT',
        text
    }},

    toggleText() { return {
        type: 'TOGGLE_TEXT'
    }}
}
</script>

<script>
function connect(component) {
    return React.createFactory(
        ReactRedux.connect((state) => {return {state: state}}, Actions)(
            component))
}

function wrap(component) {
    const b = ReactBootstrap
    const e = React.createElement

    function ConnectedComponent(props) {
        return e(b.Grid, null,
                    e(b.Row, null,
                        e(b.Col, {sm:12},
                            e(component, props))))
    }

    return connect(ConnectedComponent)
}
</script>

<body>
    <div id="app"></div>

    <script>
        const store = Redux.createStore(reducer, {
            text: 'initial text',
            flag: false
        })

        const e = React.createElement

        const rr = ReactRouter
        const bs = ReactBootstrap

        const app = e(ReactRouter.BrowserRouter, null,
            e(bs.Navbar, {collapseOnSelect: true},
                e(bs.Navbar.Header, null,
                    e(bs.Navbar.Brand, null,
                        e(rr.Link, {to: '/'}, 'Learn React')),
                    e(bs.Navbar.Toggle)),
                e(bs.Navbar.Collapse, null,
                    e(bs.Nav, null,
                        e(bs.NavItem, null,
                            e(rr.Link, {to: '1'}, 'Text Reverse')),
                        e(bs.NavItem, null,
                            e(rr.Link, {to: '2'}, 'Show Props'))))),

            e(rr.Match, {pattern: '/',
                         exactly: true, 
                         component: wrap(HomePage)}),

            e(rr.Match, {pattern: '1', component: wrap(TextReverse)}),
            e(rr.Match, {pattern: '2', component: wrap(Props)}))

        ReactDOM.render(
            e(ReactRedux.Provider, {store:store}, app),
            document.getElementById('app'))
    </script>
</body>
</html>
