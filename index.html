
<!DOCTYPE html>
<link rel="stylesheet" href="https://magicray.github.io/apps/bootstrap.css">
<script src="https://magicray.github.io/apps/react-app-bundle.min.js"></script>

<body><script>
const b = ReactBootstrap
const e = React.createElement

function GPS(props) {
    const onClick = (e) => {
        if ('Show Address' === props.state.gps.action) {
            props.actions.fetchAddress(
                props.state.gps.latitude,
                props.state.gps.longitude)
        } else {
            props.actions.renderGPS()
        }
    }

    return React.DOM.div(null,
        e(Menu, props),
        e(b.Grid, null,
            React.DOM.pre(null, props.state.gps.val),
            e(b.Button, {onClick}, props.state.gps.action)))
}

function Text(props) {
    const processedText = props.state.flag ?
                          props.state.text.split('').reverse().join('') :
                          props.state.text

    const textProps = {
        type: 'text',
        value: props.state.text,
        onChange: e => props.actions.updateText(e.target.value)
    }

    const buttonProps = {
        bsStyle: 'primary',
        onClick: props.actions.toggleText
    }

    const r = ReactBootstrap
    const e = React.createElement

    return React.DOM.div(null,
        e(Menu, props),
        e(b.Grid, null,
            e(r.Form, null,
                e(r.FormGroup, null,
                    e(r.FormControl, textProps),
                    e(r.ControlLabel, null, processedText),
                    e(r.ButtonToolbar, null,
                        e(r.Button, buttonProps, 'Toggle'))))))
}

function Props(props) {
    return React.DOM.div(null,
        e(Menu, props),
        e(b.Grid, null,
            React.DOM.pre(null, JSON.stringify(props, null, 4))))
}

function Home(props) {
    return React.DOM.div(null,
        e(Menu, props),
        e(b.Grid, null,
            e(ReactBootstrap.Jumbotron, null,
                React.DOM.h1(null, 'Example'))))
}

function Menu(props) {
    function a(action) {
        return {
            onClick: () => window.location = '#/' + action
        }
    }

    return e(b.Navbar, {collapseOnSelect: true},
            e(b.Navbar.Header, null,
                e(b.Navbar.Brand, null,
                    React.DOM.a(a('renderHome'), 'Learn React')),
                e(b.Navbar.Toggle)),
            e(b.Navbar.Collapse, null,
                e(b.Nav, null,
                    e(b.NavItem, a('renderText'), 'Text'),
                    e(b.NavItem, a('renderProps'), 'Props'),
                    e(b.NavItem, a('renderGPS'), 'GPS'))))
}

const state = {
    text: 'Hello World',
    flag: true,
    gps: {}
}

const actions = {}
const reducers = {}

reducers.renderHome = (state) => Home
reducers.renderText = (state) => Text
reducers.renderProps = (state) => Props

actions.renderGPS = function() {
    return new Promise(resolve => {
        navigator.geolocation.getCurrentPosition((pos) => {
            resolve(pos.coords)})
    })
}

actions.fetchAddress = function(latitude, longitude) {
    const maps = 'https://maps.googleapis.com/maps/api/geocode/json?';
    const latlng = latitude + ',' + longitude;

    return axios.get(`${maps}latlng=${latlng}`)
}

reducers.renderGPS_PromisePending = function(state) {
    state.gps.val = 'Fetching Location'
    state.gps.action = 'Show Location'
    return GPS
}

reducers.renderGPS_PromiseResolved = function(state, coords) {
    state.gps = {
        latitude: coords.latitude,
        longitude: coords.longitude,
        accuracy: coords.accuracy,
        action: 'Show Address',
        val: JSON.stringify({
            latitude: coords.latitude,
            longitude: coords.longitude,
            accuracy: coords.accuracy}, null, 4)}
}

reducers.fetchAddress_PromisePending = function(state) {
    state.gps.val = 'Fetching Address'
}

reducers.fetchAddress_PromiseResolved = function(state, response) {
    state.gps.action = 'Show Location'
    state.gps.val = response.data.results[0]['formatted_address'].replace(
        /, */g, '\n')
}

reducers.fetchAddress_PromiseRejected = function(state, error) {
    state.gps.val = App.stringify(error)
    state.gps.action = 'Show Address'
}

reducers.updateText = function(state, text) {
    state.text = text
}

reducers.toggleText = function(state) {
    state.flag = state.flag? false: true
}

App.mount(state, actions, reducers, Home)
</script></body>
