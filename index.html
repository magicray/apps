<!DOCTYPE html>
<html>
<link rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

<link rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.2/lodash.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/redux/3.6.0/redux.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.0/react.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.0/react-dom.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-bootstrap/0.30.7/react-bootstrap.min.js"></script>

<head>
  <meta charset="utf-8">
  <meta name = "viewport"
        content = "width = device-width,
                   initial-scale = 1.0,
                   maximum-scale = 1.0,
                   user-scalable = no">
</head>

<script>
const HelloWorld = React.createFactory(class extends React.Component {
    constructor(props) {
        super(props);

        this.count = 0
        this.logs = [];
        this.state = {
            text: this.logs.join('\n')
        };
    }
    
    log(msg) {
        let ts = Date.now()
        this.count += 1;
        this.logs.push(`${this.count} ${ts}: ${msg}`);
    }

    componentWillMount() { 
        this.log('componentWillMount()');
    }

    componentWillUpdate(nextProps, nextState) {
        this.log('componentWillUpdate()');
    }

    shouldComponentUpdate(nextProps, nextState) {
        this.log('shouldComponentUpdate()');
        return true;
    }

    componentWillReceiveProps(nextProps) {
        this.log('componentWillReceiveProps()');
    }

    componentDidMount() {
        this.log('componentDidMount()');
    }

    componentDidUpdate(prevProps, prevState) {
        this.log('componentDidUpdate()');
    }

    onEvent(e) {
        this.log(e.type);

        if(('change' === e.type) && (e.target.value)) {
            var msg = e.target.value;
        } else {
            let begin = -this.props.lines;
            let end = this.logs.length;

            if('wheel' == e.type) {
                begin += e.deltaY;
                end += e.deltaY;

                if(begin > this.logs.length - this.props.lines) {
                    begin = this.logs.length - this.props.lines;
                }
                if(end > this.logs.length) {
                    end = this.logs.length;
                }
            }

            var msg = this.logs.slice(begin, end).join('\n');
        }

        this.setState(prevState => {
            return {
                text: msg
            }
        });
    }

    render() {
        const DIV = React.createFactory('div');
        const PRE = React.createFactory('pre');
        const INPUT = React.createFactory('input');

        this.log('render()');
        return DIV({className: 'container'},
                   DIV({className: 'row'},
                       DIV({className: 'col-sm-12'},
                           INPUT({style: {width: "100%"},
                                  onChange: e => this.onEvent(e)}))),
                   DIV({className: 'row'},
                       DIV({className: 'col-sm-12'},
                           PRE({onClick: e => this.onEvent(e),
                                onWheel: e => this.onEvent(e)},
                               this.state.text))));
    }
});
</script>

<body>
    <script>
        ReactDOM.render(HelloWorld({lines: 25}), document.body);
    </script>
</body>
</html>
