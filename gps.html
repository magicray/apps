<!DOCTYPE html>
<link rel="stylesheet" href="https://magicray.github.io/apps/bootstrap.css">
<script src="/apps/external.min.js"></script>
<script src="/apps/react-app.js"></script>

<body><script>
function GPS(props) {
    const onMouseOver = (e) => {
        props.actions.fetchLocation(new Promise(resolve => {
            navigator.geolocation.getCurrentPosition((pos) => {
                resolve(pos.coords)})
        }))
     }

    const onMouseOut = (e) => {
        props.actions.clearLocation()
    }

    const p = {
        onMouseOver,
        onMouseOut,
        touchstart: onMouseOver,
        touchEnd: onMouseOut}

    return React.DOM.pre(p, props.state.gps)
}

function router(route, props) {
    return React.createElement(ReactBootstrap.Grid, null,
                React.createElement(GPS, props))
}

const state = {
    gps: ''
}

const reducers = {
    fetchLocation_PromisePending: function(state) {
        state.gps = 'Fetching Location'
    },

    fetchLocation_PromiseResolved: function(state, coords) {
        state.gps = JSON.stringify({
            latitude: coords.latitude,
            longitude: coords.longitude,
            accuracy: coords.accuracy}, null, 4)
    },

    clearLocation: function(state) {
        state.gps = ''
    }
}

App.mount({reducers, state, router})
</script></body>
