<!DOCTYPE html>
<link rel="stylesheet" href="https://magicray.github.io/apps/bootstrap.css">
<script src="/apps/external.min.js"></script>
<script src="/apps/react-app.js"></script>
<body/>
<script>
function GPS(props) {
    const onMouseOver = () => props.actions.fetchLocation()
    const onMouseOut = () => props.actions.clearLocation()

    const p = {
        onMouseOver,
        onMouseOut,
        touchstart: onMouseOver,
        touchEnd: onMouseOut}

    return e(ReactBootstrap.Grid, null,
        React.DOM.pre(p, props.state.gps))
}

const state = {
    gps: ''
}
const actions = {}
const reducers = {}

reducers.homePage = (state) => GPS

actions.fetchLocation = function() {
    return new Promise(resolve => {
        navigator.geolocation.getCurrentPosition((pos) => {
            resolve(pos.coords)})
    })
}

reducers.fetchLocation_PromisePending = function(state) {
        state.gps = 'Fetching Location'
}

reducers.fetchLocation_PromiseResolved = function(state, coords) {
    state.gps = JSON.stringify({
        latitude: coords.latitude,
        longitude: coords.longitude,
        accuracy: coords.accuracy}, null, 4)
}

reducers.clearLocation = function(state) {
    state.gps = ''
}

App.mount(state, actions, reducers)
</script>
